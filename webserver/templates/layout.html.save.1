<!DOCTYPE html>
<html>
 <head>
  <title>GESI</title>
  <link rel=stylesheet type=text/css href="{{ url_for('static', filename='style.css') }}">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="{{ url_for('static', filename='jquery.mobile.css') }}">
  <script src="{{ url_for('static', filename='jquery.js') }}"></script>
  <script src="{{ url_for('static', filename='jquery.mobile.js') }}"></script>
  <script>
$SCRIPT_ROOT = {{ request.script_root|tojson|safe }};

function drawRow(rowData,id) {
    var className = 'soundInfoList' + id 
    var row = $("<ul class=" + className + ">");
    $('#' + id).append(row);
    row.append($("<li>Samplerate:" + rowData.samplerate + "</li>"));
    row.append($("<li>Length:" + rowData.length + "</li>"));
    row.append($("<li>channels:" + rowData.channels + "</li>"));
    row.append($("</ul>"));
}
 </script>

{{ fujs.js }}
 <script>
  $( document ).ready(function(){
   $( ".switch" ).bind( "change", function(event, ui) {
     var url = flask_util.url_for('pdsend', {message: 'switch ' + $(".switch").val() });
     $.post(url)
          });
     $(".env-nav").click(function() {
       window.location = '/?env=' +$( this ).attr('id') + '&density={{ density }}'
      });
     $(".density-nav").click(function() {
       window.location = '/?env={{ env }}' + '&density=' + $( this ).attr('id') 
      });
      $(".l_play").click(function() {
        var $button = $( this );
        var url = flask_util.url_for('pdsend', {message: 'play ' + $button.attr('id') });
        $.post(url)
       });
       $(".sound_info").collapsible({expand: function(){
         $.getJSON($SCRIPT_ROOT + '/sound_info', {
           id: $(".info", this ).attr('id')
              }, function(data) {
               drawRow(data.info, data.id);
              });               
           }}).collapsible({collapse: function(){
             var c = $(".info", this ).attr('id');
              $(".soundInfoList" + c).remove();
        }});
       });
   </script>
  </head>
 <body>
  <div class=page>
   <a href="{{ url_for('show_entries',env='default',density='largo') }}"><h1>Gesi</h1></a>
   <div class=metanav>
   {% if not session.logged_in %}
     <a href="{{ url_for('login') }}">log in</a>
   {% else %}
     <a href="{{ url_for('update_db') }}">Update</a>
     <a href="{{ url_for('logout') }}">log out</a>
   {% endif %}
    </div>
   {% for message in get_flashed_messages() %}
     <div class=flash>{{ message }}</div>
    {% endfor %}
    {% block body %}{% endblock %}
    </div>
  </body>
</html>
